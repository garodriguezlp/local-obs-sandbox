# ===========================================
# PROMTAIL MINIMAL CONFIGURATION (FALLBACK)
# ===========================================
# Use this configuration if promtail 3.5.0 has compatibility issues with Loki 2.9.2
#
# TO SWITCH TO THIS CONFIG:
# 1. In docker-compose.yml, change the volume mount:
#    - ./config/promtail-config-minimal.yaml:/etc/promtail/config.yml
# 2. Restart: docker-compose restart promtail
#
# This config removes all advanced features and uses only basic functionality
# that should work across all versions.

# === SERVER CONFIGURATION ===
server:
  http_listen_port: 9080
  grpc_listen_port: 0
  log_level: info

# === POSITIONS TRACKING ===
positions:
  filename: /tmp/positions.yaml

# === LOKI CLIENT CONFIGURATION ===
clients:
  - url: http://loki:3100/loki/api/v1/push
    timeout: 30s
    backoff_config:
      min_period: 500ms
      max_period: 5m
      max_retries: 10

# === SCRAPE CONFIGURATIONS ===
scrape_configs:
  - job_name: spring-boot
    
    static_configs:
      - targets:
          - localhost
        
        labels:
          job: spring-boot
          app: demo-app
          environment: local
          __path__: /var/log/spring-boot/*.log

    # === BASIC PIPELINE ===
    # This pipeline only does the absolute minimum:
    # - Read the log file line by line
    # - Send each line to Loki as-is
    # No JSON parsing, no field extraction, no formatting
    pipeline_stages:
      # Extract static labels only
      - labels:
          job:
          app:
          environment:

# === WHAT YOU GET ===
# Logs will appear in Grafana exactly as they are in the file.
# Example query: {job="spring-boot"}
#
# To parse JSON after ingestion, use LogQL:
# {job="spring-boot"} | json | line_format "{{.level}} - {{.message}}"
#
# This is slower than parsing at ingestion time, but guarantees compatibility.
